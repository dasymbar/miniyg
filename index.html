<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Blackjack Mini App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body { background:#0b0b0b; color:#fff; font-family:Arial; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; text-align:center; }
button { background:#007aff; color:white; border:none; padding:10px 20px; margin:10px; border-radius:8px; cursor:pointer; font-size:1rem; }
button:hover { background:#005ecc; }
.row { margin-top:10px; }
</style>
</head>
<body>
<h1>üÉè Blackjack</h1>
<div id="player"></div>
<div id="dealer"></div>

<div class="row">
  <button id="hit">–í–∑—è—Ç—å –∫–∞—Ä—Ç—É</button>
  <button id="stand">–°—Ç–æ–ø</button>
  <button id="restart" style="display:none;">–°—ã–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();
Telegram.WebApp.ready();

const deck=["2","3","4","5","6","7","8","9","10","J","Q","K","A"];
let player=[], dealer=[];

function getValue(c){
  if(["J","Q","K"].includes(c)) return 10;
  if(c==="A") return 11;
  return Number(c);
}
function handValue(h){
  let total=h.map(getValue).reduce((a,b)=>a+b,0);
  let aces=h.filter(x=>x==="A").length;
  while(total>21 && aces){ total-=10; aces--; }
  return total;
}
function draw(){ return deck[Math.floor(Math.random()*deck.length)]; }

function startGame(){
  player=[draw(), draw()];
  dealer=[draw(), draw()];
  updateUI();
  document.getElementById("hit").style.display="inline-block";
  document.getElementById("stand").style.display="inline-block";
  document.getElementById("restart").style.display="none";
}

function updateUI(showDealer = false){
  document.getElementById("player").innerHTML =
    `–ò–≥—Ä–æ–∫: ${player.join(" ")} (—Å—É–º–º–∞: ${handValue(player)})`;

  if(showDealer){
    document.getElementById("dealer").innerHTML =
      `–î–∏–ª–µ—Ä: ${dealer.join(" ")} (—Å—É–º–º–∞: ${handValue(dealer)})`;
  } else {
    document.getElementById("dealer").innerHTML =
      `–î–∏–ª–µ—Ä: ${dealer[0]} ‚ùì`;
  }
}

document.getElementById("hit").onclick = ()=>{
  player.push(draw());
  updateUI();
  if(handValue(player)>=21) endGame();
};
document.getElementById("stand").onclick = endGame;
document.getElementById("restart").onclick = startGame;

function endGame(){
  document.getElementById("hit").style.display="none";
  document.getElementById("stand").style.display="none";
  document.getElementById("restart").style.display="inline-block";

  while(handValue(dealer)<17) dealer.push(draw());

  const p = handValue(player), d = handValue(dealer);
  let msg="";
  if(p>21) msg="–¢—ã –ø—Ä–æ–∏–≥—Ä–∞–ª üò¢ (–ø–µ—Ä–µ–±–æ—Ä)";
  else if(d>21) msg="–¢—ã –≤—ã–∏–≥—Ä–∞–ª üéâ (–¥–∏–ª–µ—Ä –ø–µ—Ä–µ–±—Ä–∞–ª)";
  else if(p>d) msg="–¢—ã –≤—ã–∏–≥—Ä–∞–ª üéâ";
  else if(p<d) msg="–¢—ã –ø—Ä–æ–∏–≥—Ä–∞–ª üò¢";
  else msg="–ù–∏—á—å—è ü§ù";

  updateUI(true);

  tg.sendData(JSON.stringify({
    message: msg,
    player: player.join(" "),
    dealer: dealer.join(" "),
    score: p,
    dealer_score: d
  }));
}

startGame();
</script>
</body>
</html>
