<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Blackjack Mini App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body { background:#0b0b0b; color:#fff; font-family:Arial,sans-serif; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; text-align:center; }
button { background:#007aff; color:white; border:none; padding:10px 20px; margin:10px; border-radius:8px; cursor:pointer; font-size:1rem; }
button:hover { background:#005ecc; }
.row { margin-top:10px; }
</style>
</head>
<body>
<h1>üÉè Blackjack</h1>
<div id="player"></div>
<div id="dealer"></div>
<div class="row">
  <button id="hit">–í–∑—è—Ç—å –∫–∞—Ä—Ç—É</button>
  <button id="stand">–°—Ç–æ–ø</button>
  <button id="restart" style="display:none;">–°—ã–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();
Telegram.WebApp.ready();

const deck=["2","3","4","5","6","7","8","9","10","J","Q","K","A"];
let player=[], dealer=[];

function getValue(card){ if(["J","Q","K"].includes(card)) return 10; if(card==="A") return 11; return parseInt(card); }
function handValue(hand){ let total=hand.map(getValue).reduce((a,b)=>a+b,0); let aces=hand.filter(c=>"A"===c).length; while(total>21 && aces>0){total-=10; aces--;} return total; }
function draw(){return deck[Math.floor(Math.random()*deck.length)];}

function startGame(){
  player=[draw(),draw()];
  dealer=[draw(),draw()];
  updateUI();
  document.getElementById("hit").style.display="inline-block";
  document.getElementById("stand").style.display="inline-block";
  document.getElementById("restart").style.display="none";
}

function updateUI(showDealerTotal=false){
  document.getElementById("player").innerHTML=`–ò–≥—Ä–æ–∫: ${player.join(" ")} (—Å—É–º–º–∞: ${handValue(player)})`;
  if(showDealerTotal){
    document.getElementById("dealer").innerHTML=`–î–∏–ª–µ—Ä: ${dealer.join(" ")} (—Å—É–º–º–∞: ${handValue(dealer)})`;
  } else {
    document.getElementById("dealer").innerHTML=`–î–∏–ª–µ—Ä: ${dealer[0]} ‚ùì`;
  }
}

document.getElementById("hit").onclick=()=>{
  player.push(draw());
  updateUI();
  if(handValue(player)>=21) endGame();
};

document.getElementById("stand").onclick=endGame;
document.getElementById("restart").onclick=startGame;

function endGame(){
  document.getElementById("hit").style.display="none";
  document.getElementById("stand").style.display="none";
  document.getElementById("restart").style.display="inline-block";

  while(handValue(dealer)<17) dealer.push(draw());

  const pVal=handValue(player), dVal=handValue(dealer);
  let result="";
  if(pVal>21) result="–¢—ã –ø—Ä–æ–∏–≥—Ä–∞–ª üò¢ (–ø–µ—Ä–µ–±–æ—Ä)";
  else if(dVal>21) result="–¢—ã –≤—ã–∏–≥—Ä–∞–ª üéâ (–¥–∏–ª–µ—Ä –ø–µ—Ä–µ–±—Ä–∞–ª)";
  else if(pVal>dVal) result="–¢—ã –≤—ã–∏–≥—Ä–∞–ª üéâ";
  else if(pVal<dVal) result="–¢—ã –ø—Ä–æ–∏–≥—Ä–∞–ª üò¢";
  else result="–ù–∏—á—å—è ü§ù";

  updateUI(true); // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–Ω—É—é —Ä—É–∫—É –∏ —Å—É–º–º—É –¥–∏–ª–µ—Ä–∞

  const gameData={message:result, player:player.join(" "), dealer:dealer.join(" "), score:pVal};

  // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è iOS, —á—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ –¥–æ—à–ª–∏
  setTimeout(()=> tg.sendData(JSON.stringify(gameData)), 200);
}

startGame();
</script>
</body>
</html>
