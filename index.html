<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>Blackjack Mini App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
      body {
        background-color: #0b0b0b;
        color: #fff;
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
      }
      .card {
        font-size: 2rem;
        margin: 5px;
      }
      button {
        background-color: #007aff;
        color: white;
        border: none;
        padding: 10px 20px;
        margin: 10px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
      }
      button:hover {
        background-color: #005ecc;
      }
      .row {
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <h1>üÉè Blackjack</h1>
    <div id="player"></div>
    <div id="dealer"></div>

    <div class="row">
      <button id="hit">–í–∑—è—Ç—å –∫–∞—Ä—Ç—É</button>
      <button id="stand">–°—Ç–æ–ø</button>
    </div>

    <script>
      const tg = window.Telegram.WebApp;

      // üîπ –û—á–µ–Ω—å –≤–∞–∂–Ω–æ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞:
      Telegram.WebApp.ready(); 
      tg.expand();

      const deck = ["2","3","4","5","6","7","8","9","10","J","Q","K","A"];

      function getValue(card) {
        if (["J", "Q", "K"].includes(card)) return 10;
        if (card === "A") return 11;
        return parseInt(card);
      }

      function handValue(hand) {
        let total = hand.map(getValue).reduce((a, b) => a + b, 0);
        let aces = hand.filter(c => c === "A").length;
        while (total > 21 && aces > 0) {
          total -= 10;
          aces--;
        }
        return total;
      }

      let player = [draw(), draw()];
      let dealer = [draw(), draw()];
      updateUI();

      function draw() {
        return deck[Math.floor(Math.random() * deck.length)];
      }

      function updateUI() {
        document.getElementById("player").innerHTML =
          `–ò–≥—Ä–æ–∫: ${player.join(" ")} (—Å—É–º–º–∞: ${handValue(player)})`;
        document.getElementById("dealer").innerHTML =
          `–î–∏–ª–µ—Ä: ${dealer[0]} ‚ùì`;
      }

      document.getElementById("hit").onclick = () => {
        player.push(draw());
        updateUI();
        if (handValue(player) >= 21) endGame();
      };

      document.getElementById("stand").onclick = endGame;

      function endGame() {
        document.getElementById("hit").disabled = true;
        document.getElementById("stand").disabled = true;

        while (handValue(dealer) < 17) dealer.push(draw());

        const pVal = handValue(player);
        const dVal = handValue(dealer);

        let result = "";
        if (pVal > 21) result = "–¢—ã –ø—Ä–æ–∏–≥—Ä–∞–ª üò¢ (–ø–µ—Ä–µ–±–æ—Ä)";
        else if (dVal > 21) result = "–¢—ã –≤—ã–∏–≥—Ä–∞–ª üéâ (–¥–∏–ª–µ—Ä –ø–µ—Ä–µ–±—Ä–∞–ª)";
        else if (pVal > dVal) result = "–¢—ã –≤—ã–∏–≥—Ä–∞–ª üéâ";
        else if (pVal < dVal) result = "–¢—ã –ø—Ä–æ–∏–≥—Ä–∞–ª üò¢";
        else result = "–ù–∏—á—å—è ü§ù";

        document.getElementById("dealer").innerHTML =
          `–î–∏–ª–µ—Ä: ${dealer.join(" ")} (—Å—É–º–º–∞: ${dVal})`;

        // üîπ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ Telegram
        const gameData = {
          message: result,
          player: player.join(" "),
          dealer: dealer.join(" "),
          score: pVal
        };

        // üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Telegram
        tg.sendData(JSON.stringify(gameData));

        // ‚ö†Ô∏è –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª–æ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞—Ö
        // setTimeout(() => tg.close(), 1500);
      }
    </script>
  </body>
</html>
